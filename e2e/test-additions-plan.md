# E2Eテスト追加計画書

## 概要
既存のE2Eテストに対して、今回実装した新機能のテストを追加する計画書です。
各機能について、どのファイルにどのようなテストを追加すべきかを詳細に記載します。

---

## 1. ファイル削除機能のテスト追加

### 追加先ファイル
`e2e/02-upload-flow.spec.ts` または新規ファイル `e2e/04-file-management.spec.ts`

### 追加するテスト項目

#### 1.1 ファイル削除の基本機能
```typescript
test.describe('ファイル削除機能', () => {
  test('ダッシュボードからファイルを削除できる', async ({ page }) => {
    // 検証内容:
    // 1. ダッシュボードでファイル一覧を表示
    // 2. 削除ボタンが表示されていることを確認
    // 3. 削除ボタンをクリック
    // 4. 確認ダイアログが表示される
    // 5. 確認ダイアログで「OK」をクリック
    // 6. ファイルが一覧から消える
    // 7. ファイル数が1つ減ることを確認
  });
});
```

#### 1.2 削除のキャンセル機能
```typescript
test('削除確認ダイアログでキャンセルできる', async ({ page }) => {
  // 検証内容:
  // 1. 削除ボタンをクリック
  // 2. 確認ダイアログでキャンセルをクリック
  // 3. ファイルが削除されずに残っていることを確認
  // 4. ファイル数が変わらないことを確認
});
```

#### 1.3 削除ボタンの状態管理
```typescript
test('削除処理中はボタンが「削除中...」に変わる', async ({ page }) => {
  // 検証内容:
  // 1. 削除ボタンをクリック
  // 2. 確認ダイアログでOKをクリック
  // 3. ボタンテキストが「削除中...」に変わることを確認
  // 4. ボタンが無効化されることを確認
  // 5. 削除完了後、ボタンが消える（ファイルごと）
});
```

#### 1.4 複数ファイルの削除
```typescript
test('複数のファイルを個別に削除できる', async ({ page }) => {
  // 検証内容:
  // 1. 2つ以上のファイルをアップロード
  // 2. 最初のファイルを削除
  // 3. 削除されたファイルが消えることを確認
  // 4. 他のファイルは残っていることを確認
  // 5. 2つ目のファイルも削除
  // 6. 正しく削除されることを確認
});
```

---

## 2. 翻訳機能の詳細テスト追加

### 追加先ファイル
`e2e/03-preview-flow.spec.ts` または新規ファイル `e2e/05-translation-flow.spec.ts`

### 追加するテスト項目

#### 2.1 単一スライド翻訳
```typescript
test.describe('翻訳機能', () => {
  test('現在のスライドのみを翻訳できる', async ({ page }) => {
    // 検証内容:
    // 1. プレビューページで言語を選択（日本語→英語）
    // 2. 「現在のスライドを翻訳」ボタンをクリック
    // 3. ボタンが「翻訳中...」に変わることを確認
    // 4. 翻訳結果が表示される
    // 5. 原文と翻訳文の両方が表示される
    // 6. 現在のスライドのみ翻訳済みマークが付く
  });
});
```

#### 2.2 全スライド一括翻訳
```typescript
test('すべてのスライドを一括翻訳できる', async ({ page }) => {
  // 検証内容:
  // 1. 「すべて翻訳」ボタンをクリック
  // 2. ボタンが「翻訳中...」に変わる
  // 3. 全スライドに翻訳結果が表示される
  // 4. サムネイル一覧で全スライドに✓マークが表示される
  // 5. 各スライドに切り替えて翻訳を確認
});
```

#### 2.3 翻訳文の編集機能
```typescript
test('翻訳結果を編集できる', async ({ page }) => {
  // 検証内容:
  // 1. 翻訳済みのテキストで「編集」ボタンをクリック
  // 2. テキストエリアが表示される
  // 3. テキストを修正して「保存」をクリック
  // 4. 修正内容が反映される
  // 5. 編集モードが終了する
});

test('翻訳文をダブルクリックで編集モードに入れる', async ({ page }) => {
  // 検証内容:
  // 1. 翻訳済みテキストをダブルクリック
  // 2. 編集モードに入る
  // 3. テキストを修正
  // 4. 保存して反映を確認
});
```

#### 2.4 翻訳言語の切り替え
```typescript
test('翻訳言語を切り替えできる', async ({ page }) => {
  // 検証内容:
  // 1. 言語選択ドロップダウンで「英語」を選択
  // 2. 翻訳実行
  // 3. 英語に翻訳される
  // 4. 言語を「中国語」に変更
  // 5. 再度翻訳実行
  // 6. 中国語に翻訳される
});
```

---

## 3. 翻訳済みファイルダウンロード機能

### 追加先ファイル
`e2e/05-translation-flow.spec.ts`

### 追加するテスト項目

#### 3.1 翻訳済みPPTXダウンロード
```typescript
test.describe('翻訳済みファイルダウンロード', () => {
  test('翻訳済みPowerPointをダウンロードできる', async ({ page }) => {
    // 検証内容:
    // 1. ファイルを翻訳（全スライド）
    // 2. 「翻訳済みをダウンロード」ボタンが有効になる
    // 3. ボタンをクリック
    // 4. ボタンが「生成中...」に変わる
    // 5. ダウンロードが開始される
    // 6. ファイル名が「translated_元のファイル名.pptx」形式
  });
});
```

#### 3.2 ダウンロードボタンの状態管理
```typescript
test('翻訳前はダウンロードボタンが無効', async ({ page }) => {
  // 検証内容:
  // 1. 翻訳前の状態でボタンが無効化されている
  // 2. ボタンがグレーアウトしている
  // 3. ツールチップが表示される
});

test('部分翻訳でもダウンロード可能', async ({ page }) => {
  // 検証内容:
  // 1. 1スライドのみ翻訳
  // 2. ダウンロードボタンが有効になる
  // 3. ダウンロード実行
  // 4. 翻訳されたスライドのみ翻訳が適用される
});
```

---

## 4. プロフィール機能のテスト

### 追加先ファイル
新規ファイル `e2e/06-profile-flow.spec.ts`

### 追加するテスト項目

#### 4.1 プロフィール画面への遷移
```typescript
test.describe('プロフィール機能', () => {
  test('ヘッダーのプロフィールボタンから遷移できる', async ({ page }) => {
    // 検証内容:
    // 1. ダッシュボードにアクセス
    // 2. ヘッダーのプロフィールボタン（アバター）を確認
    // 3. アバターにユーザーのイニシャルが表示される
    // 4. プロフィールボタンをクリック
    // 5. /profile ページへ遷移
    // 6. プロフィール画面が表示される
  });
});
```

#### 4.2 プロフィール情報の表示
```typescript
test('プロフィール情報が正しく表示される', async ({ page }) => {
  // 検証内容:
  // 1. ユーザーID（最初の8文字）が表示される
  // 2. メールアドレスが表示される
  // 3. アバター（イニシャル）が表示される
  // 4. 表示名フィールドがある
});
```

#### 4.3 タブ切り替え機能
```typescript
test('設定タブを切り替えできる', async ({ page }) => {
  // 検証内容:
  // 1. デフォルトで「プロフィール」タブが選択されている
  // 2. 「一般設定」タブをクリック
  // 3. 設定内容が表示される
  // 4. タブがハイライトされる
  // 5. 「通知設定」「セキュリティ」タブも同様に確認
});
```

#### 4.4 プロフィール編集
```typescript
test('プロフィール情報を編集できる', async ({ page }) => {
  // 検証内容:
  // 1. 表示名を変更
  // 2. 電話番号を入力
  // 3. 所在地を入力
  // 4. 生年月日を選択
  // 5. 自己紹介を入力
  // 6. 「変更を保存」ボタンをクリック
  // 7. 成功メッセージが表示される
  // 8. ページをリロードして変更が保持されている
});
```

---

## 5. 設定機能のテスト

### 追加先ファイル
`e2e/06-profile-flow.spec.ts`

### 追加するテスト項目

#### 5.1 一般設定
```typescript
test.describe('一般設定', () => {
  test('表示言語を変更できる', async ({ page }) => {
    // 検証内容:
    // 1. 「一般設定」タブを開く
    // 2. 言語ドロップダウンで「English」を選択
    // 3. 「設定を保存」をクリック
    // 4. 設定が保存される
  });

  test('テーマを変更できる', async ({ page }) => {
    // 検証内容:
    // 1. ライトモード/ダークモードを切り替え
    // 2. 設定を保存
    // 3. テーマが適用される
  });

  test('自動翻訳設定をON/OFFできる', async ({ page }) => {
    // 検証内容:
    // 1. 自動翻訳トグルをクリック
    // 2. ON/OFF状態が切り替わる
    // 3. 設定を保存
  });
});
```

#### 5.2 通知設定
```typescript
test.describe('通知設定', () => {
  test('メール通知をON/OFFできる', async ({ page }) => {
    // 検証内容:
    // 1. 「通知設定」タブを開く
    // 2. メール通知トグルをクリック
    // 3. 状態が切り替わる
  });

  test('通知カテゴリを個別に設定できる', async ({ page }) => {
    // 検証内容:
    // 1. 各カテゴリのチェックボックスを変更
    // 2. 「通知設定を保存」をクリック
    // 3. 設定が保存される
  });
});
```

#### 5.3 セキュリティ設定
```typescript
test.describe('セキュリティ設定', () => {
  test('2段階認証を有効化できる', async ({ page }) => {
    // 検証内容:
    // 1. 「セキュリティ」タブを開く
    // 2. 2段階認証トグルをON
    // 3. 説明テキストが表示される
    // 4. トグルをOFFに戻せる
  });

  test('パスワード変更ボタンが機能する', async ({ page }) => {
    // 検証内容:
    // 1. 「パスワードを変更」ボタンをクリック
    // 2. パスワード変更画面またはモーダルが表示される
  });
});
```

---

## 6. ズーム・パン機能の詳細テスト

### 追加先ファイル
`e2e/03-preview-flow.spec.ts`

### 追加するテスト項目

#### 6.1 ズーム機能
```typescript
test.describe('ズーム・パン機能', () => {
  test('ズームコントロールが動作する', async ({ page }) => {
    // 検証内容:
    // 1. ズームインボタンをクリック
    // 2. ズームレベルが125%になる
    // 3. さらにクリックで150%、175%...と増加
    // 4. 最大300%まで
    // 5. ズームアウトで減少
    // 6. 最小50%まで
    // 7. リセットボタンで100%に戻る
  });

  test('Ctrl+マウスホイールでズーム', async ({ page }) => {
    // 検証内容:
    // 1. Ctrlキーを押しながらホイール上
    // 2. ズームイン
    // 3. Ctrlキーを押しながらホイール下
    // 4. ズームアウト
  });
});
```

#### 6.2 パン（移動）機能
```typescript
test('ドラッグで画像を移動できる', async ({ page }) => {
  // 検証内容:
  // 1. ズームイン（150%）
  // 2. プレビューエリアをドラッグ
  // 3. 画像が移動する
  // 4. カーソルが「つかむ」アイコンになる
  // 5. ドラッグ中は「つかんでいる」アイコン
  // 6. リセットボタンで位置が初期化
});
```

---

## 7. テキストハイライト機能

### 追加先ファイル
`e2e/03-preview-flow.spec.ts`

### 追加するテスト項目

#### 7.1 テキストクリックでハイライト
```typescript
test.describe('テキストハイライト', () => {
  test('テキストクリックで位置をハイライト', async ({ page }) => {
    // 検証内容:
    // 1. テキスト内容の原文をクリック
    // 2. テキストが黄色背景でハイライト
    // 3. プレビュー上に黄色ボックスが表示
    // 4. ボックスがアニメーション（pulse）
    // 5. 再度クリックでハイライト解除
  });

  test('複数テキストの切り替え', async ({ page }) => {
    // 検証内容:
    // 1. 最初のテキストをクリック
    // 2. ハイライトされる
    // 3. 別のテキストをクリック
    // 4. 前のハイライトが解除
    // 5. 新しいテキストがハイライト
  });
});
```

---

## 8. スライドナビゲーション機能

### 追加先ファイル
`e2e/03-preview-flow.spec.ts`

### 追加するテスト項目

#### 8.1 スライド切り替え
```typescript
test.describe('スライドナビゲーション', () => {
  test('前へ/次へボタンで切り替え', async ({ page }) => {
    // 検証内容:
    // 1. 「次へ」ボタンをクリック
    // 2. スライド2へ移動
    // 3. スライド番号が「2 / n」になる
    // 4. 「前へ」ボタンが有効になる
    // 5. 最後のスライドで「次へ」が無効
    // 6. 最初のスライドで「前へ」が無効
  });

  test('サムネイルクリックで直接移動', async ({ page }) => {
    // 検証内容:
    // 1. サムネイル一覧から3番目をクリック
    // 2. スライド3へ直接移動
    // 3. サムネイルがハイライト（青枠）
    // 4. テキスト内容が更新される
  });

  test('スライド切り替え時の状態リセット', async ({ page }) => {
    // 検証内容:
    // 1. スライド1でズームイン
    // 2. テキストをハイライト
    // 3. スライド2へ移動
    // 4. ズームがリセット（100%）
    // 5. ハイライトが解除
    // 6. 位置がリセット
  });
});
```

---

## 9. レスポンシブデザインの詳細テスト

### 追加先ファイル
`e2e/07-responsive.spec.ts`（新規）

### 追加するテスト項目

#### 9.1 モバイル表示
```typescript
test.describe('モバイルレスポンシブ', () => {
  test('モバイルでヘッダーが適切に表示', async ({ page }) => {
    // 検証内容:
    // 1. ビューポート375px
    // 2. プロフィールボタンのテキストが非表示
    // 3. アイコンのみ表示
    // 4. ログアウトボタンもアイコンのみ
    // 5. タイトルが適切にラップ
  });

  test('モバイルでプロフィール画面', async ({ page }) => {
    // 検証内容:
    // 1. タブが縦並びまたはドロップダウン
    // 2. フォームフィールドが縦並び
    // 3. ボタンが全幅
  });
});
```

---

## 10. エラーハンドリングの詳細テスト

### 追加先ファイル
`e2e/08-error-handling.spec.ts`（新規）

### 追加するテスト項目

#### 10.1 削除エラー
```typescript
test.describe('エラーハンドリング', () => {
  test('ファイル削除失敗時のエラー表示', async ({ page }) => {
    // 検証内容:
    // 1. ネットワークエラーをシミュレート
    // 2. 削除ボタンをクリック
    // 3. エラーメッセージが表示
    // 4. ファイルは削除されない
    // 5. 再試行可能
  });
});
```

#### 10.2 翻訳エラー
```typescript
test('翻訳API失敗時のエラー表示', async ({ page }) => {
  // 検証内容:
  // 1. 翻訳APIエラーをシミュレート
  // 2. 翻訳ボタンをクリック
  // 3. エラーメッセージ表示
  // 4. ボタンが元に戻る
  // 5. 再試行可能
});
```

---

## 実装優先順位

### 高優先度（必須）
1. ファイル削除機能のテスト
2. 翻訳機能の基本テスト
3. プロフィール画面への遷移テスト
4. 翻訳済みファイルダウンロードテスト

### 中優先度（重要）
1. 翻訳文編集機能のテスト
2. プロフィール編集テスト
3. 設定変更テスト
4. ズーム・パン機能テスト

### 低優先度（あると良い）
1. テキストハイライト機能テスト
2. 詳細なレスポンシブテスト
3. エラーハンドリングの詳細テスト
4. パフォーマンステスト

---

## 実行環境の準備

### テストデータの準備
```bash
# テスト用PPTXファイルの配置
e2e/fixtures/test-presentation.pptx  # 既存
e2e/fixtures/multi-slide.pptx        # 複数スライド用（新規）
e2e/fixtures/large-file.pptx         # 大容量ファイル用（新規）
```

### 環境変数の設定
```bash
# .env.test
TEST_USER_EMAIL=test@example.com
TEST_USER_PASSWORD=Test123!@#
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### テスト実行コマンド
```bash
# 新機能のテストのみ実行
npm run test:e2e -- --grep "削除|翻訳|プロフィール|ダウンロード"

# 特定ファイルのテスト実行
npm run test:e2e e2e/04-file-management.spec.ts

# デバッグモードで実行
npm run test:e2e:debug

# ヘッドレスモードを無効化して実行
npm run test:e2e --headed
```

---

## 注意事項

1. **既存テストとの整合性**
   - 既存のテストを壊さないよう注意
   - 共通のセットアップ処理を再利用

2. **テストの独立性**
   - 各テストは独立して実行可能にする
   - テスト間の依存関係を作らない

3. **待機処理**
   - 非同期処理は適切に待機
   - `waitForLoadState('networkidle')`を活用

4. **セレクタの安定性**
   - data-testid属性を優先的に使用
   - テキストベースのセレクタは最小限に

5. **エラーメッセージ**
   - アサーションには明確なエラーメッセージを含める
   - デバッグしやすいメッセージにする