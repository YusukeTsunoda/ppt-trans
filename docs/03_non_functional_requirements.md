# PPT Translator App - 非機能要件書

## 1. 概要

本書は、PPT Translator Appの非機能要件を定義します。システムの品質特性、制約事項、および運用要件を規定し、システムが満たすべき性能、信頼性、セキュリティなどの基準を明確にします。

## 2. パフォーマンス要件

### 2.1 SLO/SLA定義

| 指標 | SLI | SLO | SLA | 測定方法 |
|------|-----|-----|-----|----------|
| **API応答時間** | p50 | < 200ms | < 500ms | APMツール |
| | p95 | < 500ms | < 1s | APMツール |
| | p99 | < 1s | < 2s | APMツール |
| **翻訳ジョブ完了** | 10スライド | 60s以内 90% | 120s以内 95% | ジョブログ |
| | 50スライド | 180s以内 90% | 300s以内 95% | ジョブログ |
| **アップロード処理** | 10MB | 10s以内 | 30s以内 | アクセスログ |
| | 50MB | 30s以内 | 60s以内 | アクセスログ |
| **システム稼働率** | 月間 | 99.9% | 99.5% | Uptime Robot |
| **エラー率** | APIエラー | < 0.1% | < 1% | エラーログ |

### 2.2 容量モデルと費用見積

#### ユーザー別使用量モデル
| プラン | MAU | ファイル/月 | 文字数/月 | Claude API費用 | ストレージ |
|-------|-----|------------|------------|-----------------|----------|
| Free | 5,000 | 5 | 50K | $0 | 25GB |
| Starter | 2,000 | 30 | 500K | $100/月 | 60GB |
| Pro | 500 | 100 | 2M | $200/月 | 50GB |
| 合計 | 7,500 | - | - | $300/月 | 135GB |

#### システム全体負荷
| メトリクス | 目標値 | ピーク値 | 備考 |
|-----------|---------|----------|------|
| 同時接続数 | 500 | 1,000 | Vercel制限内 |
| 同時ジョブ数 | 50 | 100 | キュー制御 |
| APIコール/日 | 50,000 | 100,000 | Claude API制限 |
| DBコネクション | 20 | 50 | Supabase無料枠 |
| 帯域幅/月 | 1TB | 2TB | Vercel+Supabase |

### 2.3 リソース使用率

| リソース | 通常時 | ピーク時許容値 |
|---------|--------|--------------|
| CPU使用率 | 40%以下 | 80%以下 |
| メモリ使用率 | 60%以下 | 85%以下 |
| ディスクI/O | 50%以下 | 90%以下 |
| ネットワーク帯域 | 30%以下 | 70%以下 |

## 3. 可用性要件

### 3.1 稼働率要件

| サービスレベル | 目標値 | 計算方法 |
|--------------|--------|---------|
| 月間稼働率 | 99.9% | (稼働時間÷全時間)×100 |
| 年間稼働率 | 99.5% | 計画メンテナンス除く |
| 許容ダウンタイム/月 | 43分 | 計画外停止 |
| 許容ダウンタイム/年 | 43時間 | 計画メンテナンス含む |

### 3.2 障害復旧要件

| 障害レベル | RTO（目標復旧時間） | RPO（目標復旧時点） |
|-----------|-------------------|------------------|
| Critical（サービス全停止） | 1時間 | 1時間 |
| High（主要機能障害） | 4時間 | 4時間 |
| Medium（一部機能障害） | 24時間 | 12時間 |
| Low（軽微な不具合） | 72時間 | 24時間 |

### 3.3 バックアップ要件

| データ種別 | バックアップ頻度 | 保持期間 | 復元時間 |
|-----------|---------------|---------|----------|
| データベース | 1日1回（差分）、週1回（完全） | 30日 | 2時間以内 |
| ユーザーファイル | リアルタイム（3重化） | 90日 | 1時間以内 |
| システム設定 | 変更時即時 | 無期限 | 30分以内 |
| ログファイル | 1時間ごと | 1年 | 4時間以内 |

## 4. セキュリティ要件

### 4.1 認証・認可要件（STRIDE脅威モデル対応）

| 脅威 | 対策 | 実装 |
|------|------|------|
| **Spoofing**（なりすまし） | 強固な認証 | Supabase Auth + MFA |
| **Tampering**（改ざん） | データ保護 | HTTPS、署名検証 |
| **Repudiation**（否認） | 監査ログ | 全操作ログ記録 |
| **Info Disclosure**（情報漏洩） | 暗号化 | AES-256、RLS |
| **DoS**（サービス拒否） | レート制限 | APIレート制限 |
| **Elevation**（権限昇格） | 最小権限 | RBAC、RLS |

#### 具体的要件
| 要件項目 | 仕様 |
|---------|------|
| パスワードポリシー | 最小8文字、英数字記号混在、bcryptハッシュ |
| 多要素認証 | TOTP/SMS対応、管理者は必須 |
| セッション管理 | JWT（有効期限: 30分）、リフレッシュトークン |
| アカウントロック | 5回失敗で30分ロック、CAPTCHA |
| 権限管理 | Supabase RLS + カスタムロール |

### 4.2 データ保護要件

| 保護対象 | 要件 |
|---------|------|
| 通信暗号化 | TLS 1.3以上、HSTS有効化 |
| データ暗号化 | AES-256（保存時）、機密データは個別暗号化 |
| 個人情報保護 | GDPR/個人情報保護法準拠、データマスキング |
| ファイル暗号化 | アップロードファイルは暗号化保存 |
| APIキー管理 | 環境変数/シークレット管理サービス使用 |

### 4.3 セキュリティ監査要件

| 監査項目 | 頻度 | 実施内容 |
|---------|------|---------|
| 脆弱性診断 | 四半期 | OWASP Top 10準拠 |
| ペネトレーションテスト | 年2回 | 外部専門業者による |
| コード監査 | リリース前 | 静的解析ツール使用 |
| アクセスログ監査 | 月次 | 不正アクセス検知 |
| 権限棚卸し | 四半期 | 不要権限の削除 |

## 5. 拡張性要件

### 5.1 スケーラビリティ要件

| 項目 | 現在 | 1年後目標 | 3年後目標 |
|------|------|-----------|-----------|
| ユーザー数 | 1,000 | 10,000 | 100,000 |
| 月間処理ファイル数 | 10,000 | 100,000 | 1,000,000 |
| ストレージ容量 | 1TB | 10TB | 100TB |
| 同時接続数 | 100 | 1,000 | 10,000 |

### 5.2 アーキテクチャ要件

- **水平スケーリング**: アプリケーションサーバーの自動スケーリング
- **データベース**: 読み取りレプリカ、シャーディング対応
- **キャッシュ**: Redis/Memcachedによる多層キャッシュ
- **CDN**: 静的コンテンツの地理的分散配信
- **マイクロサービス**: 機能単位でのサービス分割可能

## 6. 信頼性要件

### 6.1 エラー処理要件

| エラー種別 | 処理方法 | ユーザー通知 |
|-----------|---------|------------|
| 一時的エラー | 自動リトライ（3回まで） | 処理中表示 |
| API制限エラー | キューイング、遅延実行 | 待機時間表示 |
| データ不整合 | トランザクションロールバック | エラーメッセージ |
| システムエラー | フォールバック処理 | メンテナンス画面 |

### 6.2 データ整合性要件

- **トランザクション管理**: ACID特性の保証
- **楽観的ロック**: 同時更新の制御
- **イベントソーシング**: 変更履歴の完全保持
- **データ検証**: 入出力時の整合性チェック
- **冪等性**: API操作の冪等性保証

## 7. 保守性要件

### 7.1 ログ要件

| ログ種別 | 保存期間 | ローテーション | 用途 |
|---------|---------|--------------|------|
| アクセスログ | 90日 | 日次 | アクセス解析 |
| エラーログ | 1年 | 日次 | 障害調査 |
| アプリケーションログ | 30日 | 日次 | デバッグ |
| 監査ログ | 3年 | 月次 | コンプライアンス |
| パフォーマンスログ | 7日 | 日次 | 性能分析 |

### 7.2 監視要件

| 監視項目 | 閾値 | アラート条件 | 通知先 |
|---------|------|------------|--------|
| CPU使用率 | 80% | 5分継続 | 運用チーム |
| メモリ使用率 | 85% | 5分継続 | 運用チーム |
| ディスク使用率 | 90% | 即時 | 運用チーム |
| エラー率 | 1% | 1分継続 | 開発チーム |
| 応答時間 | 5秒 | 10回連続 | 運用チーム |

### 7.3 デプロイメント要件

- **CI/CD**: 自動テスト、自動デプロイ
- **Blue-Greenデプロイ**: 無停止デプロイ
- **ロールバック**: 5分以内に前バージョンへ復帰
- **カナリアリリース**: 段階的リリース対応
- **機能フラグ**: 機能の動的ON/OFF

## 8. ユーザビリティ要件

### 8.1 アクセシビリティ要件

| 項目 | 要件 |
|------|------|
| WCAG準拠レベル | AA |
| キーボード操作 | 全機能対応 |
| スクリーンリーダー | 対応 |
| 色覚多様性 | 配慮（色のみに依存しない） |
| フォントサイズ | 可変（最小12pt） |

### 8.2 多言語対応要件

| 言語 | UI対応 | ドキュメント | 翻訳対応 |
|------|--------|------------|---------|
| 日本語 | ◯ | ◯ | ◯ |
| 英語 | ◯ | ◯ | ◯ |
| 中国語（簡体字） | ◯ | △ | ◯ |
| 中国語（繁体字） | △ | × | ◯ |
| 韓国語 | △ | × | ◯ |
| タイ語 | × | × | ◯ |
| ベトナム語 | × | × | ◯ |
| スペイン語 | × | × | ◯ |
| ポルトガル語 | × | × | ◯ |
| ドイツ語 | × | × | ◯ |
| フランス語 | × | × | ◯ |

※ ◯：対応、△：部分対応、×：未対応

### 8.3 ブラウザ・デバイス要件

| ブラウザ/デバイス | サポートレベル |
|-----------------|--------------|
| Chrome（最新2バージョン） | フルサポート |
| Firefox（最新2バージョン） | フルサポート |
| Safari（最新2バージョン） | フルサポート |
| Edge（最新2バージョン） | フルサポート |
| モバイル（iOS/Android） | レスポンシブ対応 |
| タブレット | レスポンシブ対応 |

## 9. 法規制・コンプライアンス要件

### 9.1 準拠法規

| 法規制 | 対応内容 |
|--------|---------|
| GDPR | データポータビリティ、削除権、同意管理 |
| 個人情報保護法 | 利用目的明示、第三者提供制限 |
| 著作権法 | コンテンツの権利確認、利用規約明記 |
| 電子帳簿保存法 | タイムスタンプ、改ざん防止 |

### 9.2 業界標準準拠

| 標準 | 準拠内容 |
|------|---------|
| ISO 27001 | 情報セキュリティマネジメント |
| PCI DSS | クレジットカード情報保護（該当する場合） |
| SOC 2 Type II | セキュリティ、可用性、処理の完全性 |

## 10. 運用要件

### 10.1 メンテナンス要件

| メンテナンス種別 | 頻度 | 実施時間帯 | 最大停止時間 |
|----------------|------|-----------|------------|
| 定期メンテナンス | 月1回 | 日曜2:00-6:00 | 4時間 |
| セキュリティパッチ | 随時 | 緊急度による | 30分 |
| バージョンアップ | 四半期 | 日曜2:00-6:00 | 2時間 |
| データベース最適化 | 週1回 | 日曜3:00-4:00 | 無停止 |

### 10.2 サポート要件

| サポートレベル | 対応時間 | 応答時間 | 解決目標時間 |
|--------------|---------|---------|------------|
| Critical | 24/7 | 15分 | 4時間 |
| High | 営業時間内 | 1時間 | 24時間 |
| Medium | 営業時間内 | 4時間 | 3営業日 |
| Low | 営業時間内 | 24時間 | 5営業日 |

### 10.3 ドキュメント要件

| ドキュメント種別 | 更新頻度 | 管理方法 |
|---------------|---------|---------|
| ユーザーマニュアル | リリース時 | オンラインヘルプ |
| API仕様書 | 変更時即時 | OpenAPI/Swagger |
| 運用手順書 | 四半期 | Wiki |
| 障害対応手順書 | 随時 | Wiki |
| システム構成図 | 変更時 | バージョン管理 |

## 11. 環境要件

### 11.1 開発環境

| 項目 | 仕様 |
|------|------|
| OS | macOS/Linux/Windows（WSL2） |
| Node.js | v20.x LTS |
| React | v19.0.0 |
| Python | v3.13+ |
| パッケージマネージャー | npm (Node.js) / UV (Python) |
| データベース | PostgreSQL 15+ / Supabase |
| キャッシュ | Redis 7+ |
| コンテナ | Docker/Docker Compose |

### 11.2 ステージング環境

- 本番環境と同等構成
- 本番データのサブセット使用
- 自動デプロイ対応

### 11.3 本番環境（MVP推奨構成）

| コンポーネント | MVP推奨仕様 | 理由 |
|-------------|------------|------|
| クラウドプロバイダー | Vercel | フロントエンドのホスティングとデプロイ体験が最高。Next.jsとの完璧な統合 |
| コンピューティング | Vercel Serverless Functions | Kubernetesは不要。サーバー管理不要でAPIをデプロイ可能。自動スケーリング、従量課金でMVPに最適 |
| Python実行環境 | Dockerコンテナ（サンドボックス化） | 最小権限、ネットワーク制限、ファイルI/O制限でセキュリティを確保 |
| データベース | Supabase Database | PostgreSQL互換。認証・ストレージも含む統合プラットフォーム。無料枠が充実 |
| ストレージ | Supabase Storage | Supabaseに統合されたストレージ。S3互換API、設定が簡単 |
| CDN | Vercel Edge Network | 追加設定不要。Vercelデプロイで自動的にグローバルCDN配信 |
| 監視 | Vercel Analytics & Logs | Vercelダッシュボードでアクセス解析とログ確認。MVPに必要十分 |
| 認証 | Supabase Auth | OAuth、メール認証、MFA対応。Supabase DBと完全統合 |
| 決済 | Stripe | サブスクリプション管理、国際決済対応。開発者フレンドリー |

## 12. 移行要件

### 12.1 データ移行

- 既存システムからのデータ移行ツール提供
- 移行中のダウンタイム最小化（1時間以内）
- データ整合性検証
- ロールバック計画

### 12.2 ユーザー移行

- 段階的移行サポート
- 新旧システム並行稼働期間（1ヶ月）
- ユーザートレーニング提供

---
*ドキュメントバージョン: 1.0*  
*最終更新日: 2025年1月*