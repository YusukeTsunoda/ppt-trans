#!/bin/bash

echo "ğŸ”§ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’é–‹å§‹ã—ã¾ã™..."

# Check if .env file exists
if [ ! -f .env ]; then
    echo "âŒ .env ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    echo "ğŸ“ .env.example ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ .env ã‚’ä½œæˆã—ã¦ãã ã•ã„:"
    echo "   cp .env.example .env"
    echo "   ãã®å¾Œã€DATABASE_URL ã¨ NEXTAUTH_SECRET ã‚’è¨­å®šã—ã¦ãã ã•ã„"
    exit 1
fi

# Generate Prisma client
echo "ğŸ“¦ Prisma ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç”Ÿæˆä¸­..."
npx prisma generate

# Run database migrations
echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œä¸­..."
npx prisma migrate dev --name init

# Seed the database (optional)
echo "ğŸŒ± åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã—ã¾ã™ã‹ï¼Ÿ (y/n)"
read -r answer
if [ "$answer" = "y" ]; then
    npx prisma db seed
fi

echo "âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼"
echo ""
echo "ğŸ“‹ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:"
echo "1. npm run dev ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•"
echo "2. http://localhost:3000/register ã§æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²"
echo "3. ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ãªå ´åˆã¯ã€Prisma Studio ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ãƒ¼ãƒ«ã‚’ ADMIN ã«å¤‰æ›´:"
echo "   npx prisma studio"