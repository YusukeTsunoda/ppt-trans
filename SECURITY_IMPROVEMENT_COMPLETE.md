# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„å®Ÿæ–½å ±å‘Š

## å®Ÿæ–½æ—¥æ™‚
2025å¹´8æœˆ24æ—¥

## æ”¹å–„è¨ˆç”»ã¨å®Ÿæ–½å†…å®¹

### ğŸ”´ å„ªå…ˆåº¦1: å³åº§å¯¾å¿œï¼ˆCriticalï¼‰ - âœ… å®Œäº†

#### 1. auth.jsonã‚’Gitç®¡ç†ã‹ã‚‰å‰Šé™¤
```bash
âœ… å®Ÿè¡Œæ¸ˆã¿: git rm --cached auth.json
```
- Gitã®è¿½è·¡å¯¾è±¡ã‹ã‚‰å‰Šé™¤å®Œäº†
- èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¼æ´©ãƒªã‚¹ã‚¯ã‚’æ’é™¤

#### 2. .gitignoreã«è¿½åŠ 
```gitignore
# E2E test authentication
auth.json
.auth/
*.auth.json
test-results/
playwright-report/
```
- ä»Šå¾Œauth.jsonãŒã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹ã“ã¨ã‚’é˜²æ­¢
- ãƒ†ã‚¹ãƒˆçµæœãƒ•ã‚¡ã‚¤ãƒ«ã‚‚é™¤å¤–

#### 3. ã‚»ã‚­ãƒ¥ã‚¢ãªèªè¨¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ§‹é€ ã®ä½œæˆ
```
.auth/
â”œâ”€â”€ README.md          # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ³¨æ„äº‹é …ã¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
â””â”€â”€ test-auth.json     # èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆGitç®¡ç†å¤–ï¼‰
```
- `.auth/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆæ¸ˆã¿
- READMEã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’è¨˜è¼‰

### ğŸŸ¡ å„ªå…ˆåº¦2: ä»Šæ—¥ä¸­å¯¾å¿œï¼ˆHighï¼‰ - âœ… å®Œäº†

#### 4. ç’°å¢ƒãƒ™ãƒ¼ã‚¹ã®ãƒ‘ã‚¹è¨­å®š

**ä¿®æ­£ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«:**

1. **e2e/config/test-config.ts**
```javascript
// Before
storageStateFile: 'auth.json',

// After
storageStateFile: process.env.AUTH_STATE_FILE || '.auth/test-auth.json',
```

2. **e2e/auth/setup-auth.ts**
```javascript
// Before
await context.storageState({ path: 'auth.json' });

// After
const authFile = process.env.AUTH_STATE_FILE || '.auth/test-auth.json';
await context.storageState({ path: authFile });
```

3. **e2e/auth/setup-auth-refactored.ts**
```javascript
// æ—¢ã«TEST_CONFIG.auth.storageStateFileã‚’ä½¿ç”¨
// TEST_CONFIGãŒç’°å¢ƒå¤‰æ•°å¯¾å¿œæ¸ˆã¿
```

4. **playwright.config.ts**
```javascript
// Before
const authFile = path.join(__dirname, 'auth.json');

// After
const authFile = process.env.AUTH_STATE_FILE || path.join(__dirname, '.auth', 'test-auth.json');
```

### ğŸŸ¢ å„ªå…ˆåº¦3: ä»Šé€±ä¸­å¯¾å¿œï¼ˆMediumï¼‰ - âœ… å®Œäº†

#### 5. å‹•çš„ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆã®å®Ÿè£…

**ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«: scripts/generate-auth-token.js**

æ©Ÿèƒ½:
- çŸ­å‘½ãªèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ2æ™‚é–“ï¼‰
- ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ã®ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
- è‡ªå‹•å†ç”Ÿæˆã‚ªãƒ—ã‚·ãƒ§ãƒ³
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆç”Ÿæˆæ™‚åˆ»ã€æœ‰åŠ¹æœŸé™ï¼‰

**è¿½åŠ ã—ãŸNPMã‚¹ã‚¯ãƒªãƒ—ãƒˆ:**
```json
"test:e2e:auth:generate": "node scripts/generate-auth-token.js",
"test:e2e:auth:check": "node scripts/generate-auth-token.js --check",
"test:e2e:auth:refresh": "node scripts/generate-auth-token.js --force"
```

## ä½¿ç”¨æ–¹æ³•

### åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ
npm run test:e2e:auth:generate

# E2Eãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm run test:e2e
```

### ãƒˆãƒ¼ã‚¯ãƒ³ã®ç®¡ç†
```bash
# æœ‰åŠ¹æ€§ã‚’ãƒã‚§ãƒƒã‚¯
npm run test:e2e:auth:check

# å¼·åˆ¶çš„ã«å†ç”Ÿæˆ
npm run test:e2e:auth:refresh
```

### CI/CDç’°å¢ƒã§ã®ä½¿ç”¨
```bash
# ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
export AUTH_STATE_FILE=/secure/path/auth.json
export TEST_USER_EMAIL=${{ secrets.TEST_USER_EMAIL }}
export TEST_USER_PASSWORD=${{ secrets.TEST_USER_PASSWORD }}
export TOKEN_LIFETIME_HOURS=1

# ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¦ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:e2e:auth:generate
npm run test:e2e
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„ã®åŠ¹æœ

### Beforeï¼ˆãƒªã‚¹ã‚¯é«˜ï¼‰
- âŒ èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ãŒGitç®¡ç†ä¸‹
- âŒ é•·æœŸé–“æœ‰åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ2026å¹´ã¾ã§ï¼‰
- âŒ ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‘ã‚¹
- âŒ ãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•æ›´æ–°ãªã—

### Afterï¼ˆã‚»ã‚­ãƒ¥ã‚¢ï¼‰
- âœ… Gitç®¡ç†ã‹ã‚‰å®Œå…¨ã«é™¤å¤–
- âœ… çŸ­å‘½ãªãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ2æ™‚é–“ï¼‰
- âœ… ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹æŸ”è»Ÿãªè¨­å®š
- âœ… è‡ªå‹•å†ç”Ÿæˆæ©Ÿèƒ½
- âœ… ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚‹ç®¡ç†
- âœ… CI/CDå¯¾å¿œ

## ä»Šå¾Œã®æ¨å¥¨äº‹é …

### çŸ­æœŸï¼ˆ1é€±é–“ä»¥å†…ï¼‰
1. æ—¢å­˜ã®auth.jsonã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å…¨ãƒ†ã‚¹ãƒˆã®å‹•ä½œç¢ºèª
2. CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®çµ„ã¿è¾¼ã¿
3. ãƒãƒ¼ãƒ å…¨ä½“ã¸ã®å‘¨çŸ¥ã¨ç§»è¡Œ

### ä¸­æœŸï¼ˆ1ãƒ¶æœˆä»¥å†…ï¼‰
1. ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ã®ã•ã‚‰ãªã‚‹çŸ­ç¸®ï¼ˆ30åˆ†ã€œ1æ™‚é–“ï¼‰
2. ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
3. ç›£æŸ»ãƒ­ã‚°ã®å®Ÿè£…

### é•·æœŸï¼ˆ3ãƒ¶æœˆä»¥å†…ï¼‰
1. HashiCorp Vaultã‚„AWS Secrets Managerã¨ã®çµ±åˆ
2. ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ¡ç”¨
3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã®è‡ªå‹•åŒ–

## çµè«–

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒãƒ¼ãƒˆã§æŒ‡æ‘˜ã•ã‚ŒãŸå…¨ã¦ã®é«˜å„ªå…ˆåº¦ãƒªã‚¹ã‚¯ã«å¯¾å‡¦ã—ã¾ã—ãŸï¼š

1. **Gitéœ²å‡ºãƒªã‚¹ã‚¯ï¼ˆğŸ”´ Highï¼‰**: å®Œå…¨ã«æ’é™¤
2. **é•·æœŸãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆğŸŸ¡ Mediumï¼‰**: çŸ­å‘½ãƒˆãƒ¼ã‚¯ãƒ³ã«ç§»è¡Œ
3. **ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼ˆğŸŸ¡ Mediumï¼‰**: ç’°å¢ƒå¤‰æ•°åŒ–å®Œäº†

ã“ã‚Œã«ã‚ˆã‚Šã€E2Eãƒ†ã‚¹ãƒˆã®èªè¨¼ç®¡ç†ãŒå¤§å¹…ã«ã‚»ã‚­ãƒ¥ã‚¢ã«ãªã‚Šã€æœ¬ç•ªç’°å¢ƒã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«æº–æ‹ ã—ãŸå½¢ã«ãªã‚Šã¾ã—ãŸã€‚